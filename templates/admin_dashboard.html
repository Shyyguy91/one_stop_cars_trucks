{% extends "base.html" %}

{% block title %}Admin Dashboard - One Stop Cars & Trucks LLC{% endblock %}

{% block content %}
    <section class="admin-dashboard">
        <h2>Welcome to the Admin Dashboard, {{ current_user.username }}!</h2>
        <p><a href="{{ url_for('add_listing') }}" class="btn btn-add">Add New Car Listing</a></p>

        <div class="dashboard-inventory">
            <h3>All Car Listings</h3>
            {% if cars %}
                <table>
                    <thead>
                        <tr>
                            <th>Image</th>
                            <th>Make</th>
                            <th>Model</th>
                            <th>Year</th>
                            <th>Price</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for car in cars %}
                        <tr class="{{ 'sold' if car.is_sold else '' }}">
                            <td><img src="{{ url_for('static', filename='images/' + (car.image_filename if car.image_filename else 'default_car.jpg')) }}" alt="{{ car.make }}" width="100"></td>
                            <td>{{ car.make }}</td>
                            <td>{{ car.model }}</td>
                            <td>{{ car.year }}</td>
                            <td>${{ "{:,.2f}".format(car.price) }}</td>
                            <td>{{ 'Sold' if car.is_sold else 'Available' }}</td>
                            <td>
                                <a href="{{ url_for('edit_listing', car_id=car.id) }}" class="btn btn-small btn-edit">Edit</a>
                                <form action="{{ url_for('delete_listing', car_id=car.id) }}" method="POST" style="display:inline;">
                                    <button type="submit" class="btn btn-small btn-delete" onclick="return confirm('Are you sure you want to delete this listing?');">Delete</button>
                                </form>
                                {% if car.is_sold %}
                                <form action="{{ url_for('mark_available', car_id=car.id) }}" method="POST" style="display:inline;">
                                    <button type="submit" class="btn btn-small btn-available">Mark Available</button>
                                </form>
                                {% else %}
                                <form action="{{ url_for('mark_sold', car_id=car.id) }}" method="POST" style="display:inline;">
                                    <button type="submit" class="btn btn-small btn-sold">Mark Sold</button>
                                </form>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p>No car listings found. <a href="{{ url_for('add_listing') }}">Add one now!</a></p>
            {% endif %}
        </div>
    </section>
{% endblock %}